@model aws_secrets_migrator.Models.SecretsViewModel
@{
    ViewData["Title"] = "AWS Secrets Migration";
}

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

<div class="container mt-4">

    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">AWS Secrets Migration Tool</h5>
        </div>

        <div class="card-body">

            <!-- Upload Form -->
            <form asp-action="LoadFile" method="post" enctype="multipart/form-data" class="row g-3">

                <div class="col-md-4">
                    <label class="form-label">Secrets File (.txt)</label>
                    <input type="file" name="secretsFile" class="form-control" accept=".txt" required />
                </div>

                <div class="col-md-4">
                    <label class="form-label">Environment</label>
                    <select name="environment" class="form-select">
                        <option value="dev">Dev</option>
                        <option value="qa">QA</option>
                        <option value="uat">UAT</option>
                        <option value="prod">Prod</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">AWS Secret Name</label>
                    <input type="text"
                           name="secretName"
                           class="form-control"
                           placeholder="ACEEnh/dev/appsettings"
                           value="@Model.SecretName"
                           required />
                </div>

                <div class="col-12 text-end">
                    <button class="btn btn-primary">
                        Load Secrets File
                    </button>
                </div>

            </form>

            @if (Model.Secrets != null && Model.Secrets.Any())
            {
                <hr />

                <!-- Secrets Grid -->
                <form asp-action="Migrate" method="post">

                    <input type="hidden" asp-for="Environment" />
                    <input type="hidden" asp-for="SecretName" />

                    <div class="table-responsive">
                        <table class="table table-bordered table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th style="width:35%">Key</th>
                                    <th style="width:65%">Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < Model.Secrets.Count; i++)
                                {
                                    <tr>
                                        <td>
                                            <input asp-for="Secrets[i].Key" class="form-control" />
                                        </td>
                                        <td>
                                            <input asp-for="Secrets[i].Value" class="form-control" />
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="text-end">
                        <button class="btn btn-success">
                            ðŸš€ Run / Migrate to AWS
                        </button>
                    </div>

                </form>
            }

            @if (ViewBag.Message != null)
            {
                <div class="alert alert-success mt-3">
                    @ViewBag.Message
                </div>
            }

        </div>
    </div>

</div>
@section Scripts {
    <script>
        $(document).ready(function() {
            var message = '@ViewBag.ToastMessage';
            var type = '@ViewBag.ToastType';

            if (message) {
                toastr.options = {
                    "closeButton": true,
                    "progressBar": true,
                    "positionClass": "toast-top-right",
                    "timeOut": "5000"
                };

                switch(type) {
                    case 'success': toastr.success(message); break;
                    case 'info': toastr.info(message); break;
                    case 'warning': toastr.warning(message); break;
                    case 'error': toastr.error(message); break;
                    default: toastr.info(message); break;
                }
            }
        });
    </script>


    <script>
        $(document).ready(function() {
            var message = '@ViewBag.ToastMessage';
            var type = '@ViewBag.ToastType';
            if (message) {
                toastr.options = {
                    "closeButton": true,
                    "progressBar": true,
                    "positionClass": "toast-top-right",
                    "timeOut": "5000"
                };
                switch(type) {
                    case 'success': toastr.success(message); break;
                    case 'info': toastr.info(message); break;
                    case 'warning': toastr.warning(message); break;
                    case 'error': toastr.error(message); break;
                }
            }
        });
    </script>
}
